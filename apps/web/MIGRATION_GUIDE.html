<!DOCTYPE html>
<html>
<head>
  <title>JTH Operations Migration</title>
  <style>
    body { font-family: system-ui; padding: 20px; max-width: 1200px; margin: 0 auto; }
    h1 { color: #333; }
    .sql { background: #f5f5f5; padding: 20px; border-radius: 8px; overflow-x: auto; }
    pre { margin: 0; white-space: pre-wrap; }
    .button { display: inline-block; padding: 10px 20px; background: #3b82f6; color: white; text-decoration: none; border-radius: 6px; margin: 10px 0; }
    .step { margin: 20px 0; padding: 15px; background: #f0f9ff; border-left: 4px solid #3b82f6; }
  </style>
</head>
<body>
  <h1>ðŸš€ JTH Operations Platform - Database Migration</h1>
  
  <div class="step">
    <h2>Step 1: Open Supabase SQL Editor</h2>
    <a href="https://app.supabase.com/project/nsbybnsmhvviofzfgphb/sql/new" target="_blank" class="button">
      Open SQL Editor â†’
    </a>
  </div>
  
  <div class="step">
    <h2>Step 2: Copy this SQL</h2>
    <div class="sql">
      <pre>-- Quick fix for missing columns and tables

-- Add pipeline fields to leads table
ALTER TABLE leads 
ADD COLUMN IF NOT EXISTS stage VARCHAR(50) DEFAULT 'inquiry',
ADD COLUMN IF NOT EXISTS deal_value DECIMAL(10,2),
ADD COLUMN IF NOT EXISTS configurator_snapshot JSONB,
ADD COLUMN IF NOT EXISTS probability INTEGER DEFAULT 10,
ADD COLUMN IF NOT EXISTS expected_close_date DATE,
ADD COLUMN IF NOT EXISTS contract_id UUID,
ADD COLUMN IF NOT EXISTS build_id UUID;

-- Create contracts table
CREATE TABLE IF NOT EXISTS contracts (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  deal_id UUID REFERENCES leads(id),
  document_url TEXT,
  signed_at TIMESTAMPTZ,
  total_contract_value DECIMAL(10,2),
  created_at TIMESTAMPTZ DEFAULT NOW()
);

-- Create builds table
CREATE TABLE IF NOT EXISTS builds (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  build_number VARCHAR(50) UNIQUE NOT NULL,
  deal_id UUID REFERENCES leads(id),
  model VARCHAR(100),
  configuration JSONB,
  status VARCHAR(50) DEFAULT 'pending',
  scheduled_start DATE,
  scheduled_end DATE,
  created_at TIMESTAMPTZ DEFAULT NOW()
);

-- Create build_stages table
CREATE TABLE IF NOT EXISTS build_stages (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  build_id UUID REFERENCES builds(id) ON DELETE CASCADE,
  name VARCHAR(100) NOT NULL,
  sequence INTEGER NOT NULL,
  status VARCHAR(50) DEFAULT 'pending',
  started_at TIMESTAMPTZ,
  completed_at TIMESTAMPTZ,
  created_at TIMESTAMPTZ DEFAULT NOW()
);

-- Create inventory table
CREATE TABLE IF NOT EXISTS inventory (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  part_code VARCHAR(100) UNIQUE NOT NULL,
  description TEXT,
  quantity_on_hand INTEGER DEFAULT 0,
  reorder_point INTEGER DEFAULT 0,
  unit_price DECIMAL(10,2),
  created_at TIMESTAMPTZ DEFAULT NOW()
);

</pre>
    </div>
  </div>
  
  <div class="step">
    <h2>Step 3: Paste and Run</h2>
    <p>Paste the SQL above into the Supabase SQL Editor and click "Run"</p>
  </div>
  
  <div class="step">
    <h2>Step 4: Test</h2>
    <p>After running the migration, test the Operations Platform:</p>
    <a href="http://localhost:3000/ops" target="_blank" class="button">
      Open Operations Dashboard â†’
    </a>
  </div>
</body>
</html>